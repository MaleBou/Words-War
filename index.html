<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Words War - ÿ≠ÿ±ÿ® ÿßŸÑŸÉŸÑŸÖÿßÿ™ (click to stick) ¬∑ columns 22 fixed</title>
    <style>
        /* ========== STYLES (unchanged from original, only minor responsive tweaks) ========== */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; cursor: default;
        }
        .game-container {
            background-color: #ffb74d; border-radius: 20px; padding: 20px; width: 1475px;
            max-width: 1475px; min-width: 1475px; box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            display: flex; flex-direction: column; gap: 15px;
        }
        .header { text-align: center; margin-bottom: 5px; display: flex; justify-content: center; align-items: center; position: relative; padding-right: 60px; }
        h1 { font-size: 2.5rem; margin-bottom: 5px; font-weight: 800; letter-spacing: 1px; }
        .title-latin { color: #3498db; display: inline; }
        .title-separator { color: #2c3e50; display: inline; margin: 0 10px; font-weight: 300; }
        .title-arabic { color: #27ae60; display: inline; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .copyright { color: #666; font-size: 0.75rem; margin-top: 5px; font-style: italic; }
        #newGameBtnTop {
            position: absolute; right: 0; top: 50%; transform: translateY(-50%);
            padding: 8px 16px; font-size: 0.9rem; font-weight: bold; border: none; border-radius: 6px;
            cursor: pointer; transition: all 0.3s; background: linear-gradient(to right, #3498db, #2980b9); color: white;
            display: flex; align-items: center; gap: 6px;
        }
        #newGameBtnTop:hover { transform: translateY(-50%) translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.12); }
        #playDurationControl {
            position: absolute; left: 0; top: 50%; transform: translateY(-50%);
            display: flex; align-items: center; gap: 8px; background: white; padding: 6px 10px;
            border-radius: 8px; box-shadow: 0 3px 8px rgba(0,0,0,0.1); border: 2px solid #3498db;
        }
        .duration-label { font-size: 0.8rem; font-weight: bold; color: #2c3e50; white-space: nowrap; }
        .duration-time { font-size: 1rem; font-weight: bold; color: #3498db; font-family: monospace; min-width: 40px; text-align: center; }
        .duration-btn {
            width: 24px; height: 24px; border-radius: 50%; border: none; background: #3498db;
            color: white; font-weight: bold; font-size: 1rem; cursor: pointer; display: flex;
            align-items: center; justify-content: center; transition: all 0.2s;
        }
        .duration-btn:hover { transform: scale(1.1); background: #2980b9; }
        .duration-btn:active { transform: scale(0.95); }
        .main-game-area { display: flex; flex-direction: column; gap: 10px; width: 100%; }
        .top-game-area { display: flex; justify-content: space-between; align-items: flex-end; gap: 20px; width: 100%; margin-bottom: 10px; }
        .player-panel {
            width: 320px; display: flex; flex-direction: column; height: 600px; background: #f0f2f5;
            border-radius: 12px; padding: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); border: 2px solid;
        }
        .player-panel.latin-panel { border-color: #3498db; }
        .player-panel.arabic-panel { border-color: #27ae60; }
        .panel-content { display: flex; flex-direction: column; justify-content: flex-end; height: 100%; gap: 15px; }
        .panel-header {
            background: white; padding: 10px; border-radius: 8px; text-align: center;
            border: 2px solid transparent; font-size: 1.2rem; font-weight: bold; position: relative;
        }
        .latin-header { border-color: #3498db; color: #3498db; }
        .arabic-header { border-color: #27ae60; color: #27ae60; direction: rtl; }
        .turn-indicator-dot {
            display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 8px;
            animation: pulse 1.5s infinite;
        }
        .latin-header .turn-indicator-dot { background: #3498db; }
        .arabic-header .turn-indicator-dot { background: #27ae60; }
        .player-status { background: white; padding: 10px; border-radius: 8px; border: 2px solid #e0e0e0; }
        .status-item { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; }
        .status-item:last-child { margin-bottom: 0; }
        .status-label { color: #666; }
        .status-value { font-weight: bold; color: #2c3e50; }
        .arabic-panel .status-item { flex-direction: row-reverse; }
        .arabic-panel .status-label { text-align: right; }
        .arabic-panel .status-value { text-align: left; }
        .turn-time-counter {
            background: white; padding: 12px; border-radius: 8px; border: 2px solid #e0e0e0;
            text-align: center; margin-bottom: 10px;
        }
        .turn-time-label { font-size: 0.9rem; color: #666; margin-bottom: 5px; }
        .turn-time-display { font-size: 1.8rem; font-weight: bold; font-family: monospace; color: #2c3e50; letter-spacing: 2px; }
        .arabic-panel .turn-time-label { direction: rtl; }
        .draw-buttons { display: flex; flex-direction: row; justify-content: space-between; gap: 8px; width: 100%; margin-top: auto; }
        .draw-btn {
            padding: 10px 5px; border: none; border-radius: 6px; background: #5c6bc0;
            color: white; font-size: 0.85rem; font-weight: bold; cursor: pointer;
            transition: all 0.2s ease; text-align: center; flex: 1; min-width: 0;
        }
        .draw-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .draw-btn:disabled { background: #b0bec5; cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.6; }
        .draw-btn.draw-1 { background: linear-gradient(135deg, #ff4444, #cc0000) !important; }
        .draw-btn.draw-6 { background: linear-gradient(135deg, #4caf50, #388e3c); }
        .draw-btn.draw-3 { background: linear-gradient(135deg, #2196f3, #1976d2); }
        .draw-btn.draw-1:hover:not(:disabled) { background: linear-gradient(135deg, #ff5555, #dd0000) !important; }
        .draw-btn.draw-6:hover:not(:disabled) { background: linear-gradient(135deg, #4caf50, #2e7d32); }
        .draw-btn.draw-3:hover:not(:disabled) { background: linear-gradient(135deg, #2196f3, #1565c0); }
        .arabic-panel .draw-btn { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .play-racks-container { display: flex; flex-direction: column; gap: 10px; width: 100%; height: 230px; }
        .play-rack-wrapper { position: relative; width: 100%; height: 100%; }
        .play-rack-label {
            position: absolute; top: -10px; left: 10px; background: white; padding: 3px 10px;
            border-radius: 12px; font-weight: bold; font-size: 0.8rem; box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            z-index: 2; border: 2px solid;
        }
        .latin-panel .play-rack-label { color: #3498db; border-color: #3498db; }
        .arabic-panel .play-rack-label { color: #27ae60; border-color: #27ae60; right: 10px; left: auto; }
        .play-rack {
            display: flex; flex-direction: column; gap: 4px; height: 100%; padding: 12px;
            border-radius: 10px; background: white; border: 3px solid transparent; width: 100%;
        }
        .play-rack-row { display: flex; justify-content: space-between; gap: 3px; width: 100%; flex: 1; }
        .latin-panel .play-rack { border-color: #3498db; background: #e3f2fd; }
        .arabic-panel .play-rack { border-color: #27ae60; background: #e8f5e9; }
        .board-panel {
            width: 750px; display: flex; flex-direction: column; height: 780px; background: #e8e8e8;
            border-radius: 12px; padding: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            order: 2; margin: 0 auto;
        }
        .board-frame {
            background: #d5dbdb; padding: 10px; border-radius: 10px;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.15), 0 4px 8px rgba(0,0,0,0.15);
            border: 3px solid #95a5a6; flex-grow: 1; display: flex; align-items: center; justify-content: center;
        }
        .board-container {
            background: white; padding: 8px; border-radius: 6px; width: 704px; height: 704px;
            display: flex; align-items: center; justify-content: center; border: 1px solid #7b8a8b;
        }
        .board {
            display: grid; grid-template-columns: repeat(22, 32px); grid-template-rows: repeat(22, 32px);
            gap: 0; background: #f5f7fa; width: 704px; height: 704px; border: 1px solid #95a5a6;
        }
        .board-cell {
            width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;
            background: white; border: 1px solid #e0e0e0; cursor: pointer; transition: all 0.2s ease;
            font-size: 0.9rem; font-weight: bold; position: relative; box-sizing: border-box;
        }
        .board-cell:hover { transform: scale(1.05); z-index: 10; box-shadow: 0 3px 10px rgba(0,0,0,0.12); background: #f0f7ff; }
        .board-cell.filled { border: 1px solid transparent; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .board-cell.latin-tile { background: #2980b9 !important; color: white !important; }
        .board-cell.arabic-tile { background: #27ae60 !important; color: white !important; }
        .board-cell.white-column { background: #f9f9f9 !important; border-color: #e0e0e0 !important; }
        .board-cell.latin-colored { background: linear-gradient(135deg, #e1f5fe, #b3e5fc) !important; border-color: #81d4fa !important; }
        .board-cell.arabic-colored { background: linear-gradient(135deg, #e8f5e9, #c8e6c9) !important; border-color: #a5d6a7 !important; }
        .board-cell.special-red { background: linear-gradient(135deg, #ffcdd2, #ef9a9a) !important; color: #c62828 !important; font-weight: bold; border-color: #ef9a9a !important; box-shadow: 0 2px 8px rgba(239, 154, 154, 0.3); }
        .board-cell.victory-column { animation: victoryFlash 2s infinite; border-color: #ff9800 !important; }
        @keyframes victoryFlash { 0%,100%{box-shadow:0 0 10px rgba(255,152,0,0.5);}50%{box-shadow:0 0 20px rgba(255,152,0,0.8);} }
        .arabic-panel { direction: rtl; order: 3; }
        .latin-panel { order: 1; }
        .bottom-game-area { display: flex; flex-direction: column; align-items: center; gap: 15px; width: 100%; margin-top: 20px; }
        .experiment-racks-container { display: flex; flex-direction: row; justify-content: center; gap: 20px; width: 1055px; }
        .experiment-rack-wrapper { width: 555px; position: relative; }
        .experiment-rack-label {
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            background: white; padding: 3px 10px; border-radius: 12px; font-weight: bold; font-size: 0.8rem;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1); z-index: 2; border: 2px solid; white-space: nowrap;
        }
        #latin-experiment-rack-wrapper .experiment-rack-label { border-color: #3498db; color: #3498db; }
        #arabic-experiment-rack-wrapper .experiment-rack-label { border-color: #27ae60; color: #27ae60; }
        .experiment-rack {
            display: flex; justify-content: space-between; align-items: center; gap: 3px;
            min-height: 80px; padding: 12px 15px; border-radius: 10px; width: 100%;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }
        #latin-experiment-rack { background: #e3f2fd; border: 3px solid #3498db; }
        #arabic-experiment-rack { background: #e8f5e9; border: 3px solid #27ae60; }
        .slot {
            width: 50px; height: 50px; border-radius: 8px; background: white; border: 2px dashed #ddd;
            display: flex; justify-content: center; align-items: center; font-size: 1.2rem; font-weight: bold;
            cursor: pointer; transition: all 0.2s; position: relative; flex-shrink: 0;
            flex: 1; max-width: 50px; min-width: 50px; min-height: 50px; overflow: hidden;
        }
        .slot:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.12); }
        .slot.empty { border-color: #bbb; }
        .slot.filled { border: 2px solid transparent; box-shadow: 0 3px 9px rgba(0,0,0,0.12); }
        .slot.empty:hover { background: #f0f7ff; border-color: #3498db; }
        .arabic-panel .slot.empty:hover { border-color: #27ae60; }
        #latin-experiment-rack .slot.empty:hover { border-color: #3498db; }
        #arabic-experiment-rack .slot.empty:hover { border-color: #27ae60; }
        .tile {
            width: 100%; height: 100%; border-radius: 8px; position: relative; cursor: grab;
            transition: transform 0.2s; pointer-events: auto; box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            display: flex; align-items: center; justify-content: center;
            user-select: none; -webkit-user-select: none; -moz-user-select: none;
        }
        .tile:active { cursor: grabbing; }
        .tile:hover { transform: scale(1.05); }
        .board-tile { width: 100% !important; height: 100% !important; border-radius: 4px !important; padding: 2px !important; }
        .board-tile .main-letter { font-size: 1.2rem !important; position: absolute !important; text-shadow: 1px 1px 2px rgba(0,0,0,0.3) !important; }
        .board-tile .secondary-letter { width: 12px !important; height: 12px !important; font-size: 0.5rem !important; position: absolute !important; }
        .latin-tile-bg { background: linear-gradient(135deg, #3498db, #2980b9) !important; color: white !important; }
        .arabic-tile-bg { background: linear-gradient(135deg, #2ecc71, #27ae60) !important; color: white !important; }
        .main-letter { font-size: 2.2rem; font-weight: bold; position: absolute; text-shadow: 1px 1px 3px rgba(0,0,0,0.3); }
        .secondary-letter {
            width: 22px; height: 22px; border-radius: 50%; display: flex; justify-content: center;
            align-items: center; font-size: 0.8rem; font-weight: bold; color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3); position: absolute;
        }
        .latin-tile .main-letter { bottom: 4px; left: 4px; }
        .latin-tile .secondary-letter { top: 4px; right: 4px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #2ecc71, #27ae60); }
        .arabic-tile .main-letter { bottom: 4px; right: 4px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .arabic-tile .secondary-letter { top: 4px; left: 4px; background: linear-gradient(135deg, #3498db, #2980b9); }
        .blank-tile .main-letter { font-size: 1.8rem; opacity: 0.3; text-shadow: none; }
        .latin-blank { background: linear-gradient(135deg, #3498db, #2980b9) !important; }
        .latin-blank .main-letter { bottom: 4px; left: 4px; }
        .arabic-blank { background: linear-gradient(135deg, #2ecc71, #27ae60) !important; }
        .arabic-blank .main-letter { bottom: 4px; right: 4px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        #dragging-tile {
            position: fixed; pointer-events: none; z-index: 10000; transform: translate(-50%, -50%);
            opacity: 0.9; filter: drop-shadow(0 4px 12px rgba(0,0,0,0.25)); width: 50px; height: 50px;
            border-radius: 8px; display: none; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .message-display {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: white; padding: 15px 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 10001; font-weight: bold; text-align: center; max-width: 500px; display: none;
            border: 2px solid #3498db;
        }
        .victory-message { border-color: #ff9800 !important; background: linear-gradient(135deg, #fff3e0, #ffe0b2) !important; animation: victoryPulse 1.5s infinite; font-size: 1.2rem; padding: 20px 30px; }
        @keyframes victoryPulse { 0%,100%{transform:translateX(-50%) scale(1);}50%{transform:translateX(-50%) scale(1.05);} }
        @keyframes pulse { 0%{transform:scale(1);opacity:1;}50%{transform:scale(1.2);opacity:0.7;}100%{transform:scale(1);opacity:1;} }
        .applause-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7);
            display:flex; justify-content:center; align-items:center; z-index:10002; display:none;
        }
        .applause-container {
            text-align:center; background:rgba(255,255,255,0.95); padding:40px; border-radius:20px;
            box-shadow:0 0 50px rgba(255,215,0,0.8); animation:glow 2s infinite alternate;
        }
        @keyframes glow { from{box-shadow:0 0 30px rgba(255,215,0,0.6);} to{box-shadow:0 0 60px rgba(255,215,0,1);} }
        .applause-text { font-size:3rem; font-weight:bold; color:#ff9800; margin-bottom:20px; text-shadow:2px 2px 4px rgba(0,0,0,0.3); }
        .applause-emoji { font-size:4rem; animation:bounce 1s infinite; }
        @keyframes bounce { 0%,100%{transform:translateY(0);}50%{transform:translateY(-20px);} }
        .time-over-message { font-size:1.5rem; color:#2c3e50; margin-top:15px; }
        .stats-display { margin-top:20px; font-size:1.1rem; color:#34495e; line-height:1.6; }
        .stat-item { margin:8px 0; display:flex; justify-content:space-between; max-width:400px; margin-left:auto; margin-right:auto; }
        .stat-label { font-weight:bold; }
        .stat-value { font-weight:bold; color:#3498db; }
        .arabic-stat-value { color:#27ae60; }
        @media (max-width:1450px){ .game-container{width:100%;min-width:auto;max-width:100%;} h1{font-size:2rem;} .top-game-area{flex-direction:column;align-items:center;gap:20px;} .player-panel{width:100%;max-width:500px;height:auto;min-height:400px;} .panel-content{height:auto;justify-content:flex-start;} .board-panel{width:100%;max-width:750px;height:auto;order:2;} .board-frame{padding:15px;} .board-container{width:100%;height:auto;max-width:704px;max-height:704px;} .board{grid-template-columns:repeat(22,28px);grid-template-rows:repeat(22,28px);width:calc(22 * 28px);height:calc(22 * 28px);} .board-cell{width:28px;height:28px;font-size:0.8rem;} .slot{width:45px;height:45px;font-size:1.1rem;} #dragging-tile{width:45px;height:45px;} .experiment-racks-container{width:100%;flex-direction:column;align-items:center;gap:15px;} .experiment-rack-wrapper{width:100%;max-width:500px;} #playDurationControl{position:relative;left:auto;top:auto;transform:none;margin:10px auto;justify-content:center;} .draw-buttons{flex-direction:column;} }
        @media (max-width:768px){ .game-container{padding:15px;} h1{font-size:1.6rem;} .player-panel{width:100%;} .panel-content{height:auto;justify-content:flex-start;} .play-rack{min-height:200px;padding:10px;} .experiment-rack{min-height:70px;padding:10px;} .slot{width:40px;height:40px;font-size:1rem;} .board{grid-template-columns:repeat(22,24px);grid-template-rows:repeat(22,24px);width:calc(22 * 24px);height:calc(22 * 24px);} .board-cell{width:24px;height:24px;font-size:0.7rem;} #dragging-tile{width:40px;height:40px;} .turn-time-display{font-size:1.5rem;} .experiment-rack-wrapper{width:100%;max-width:450px;} .draw-btn{padding:8px 20px;font-size:0.8rem;} .applause-text{font-size:2rem;} .applause-emoji{font-size:3rem;} }
        @media (max-width:480px){ h1{font-size:1.4rem;} .copyright{font-size:0.65rem;} .play-rack{min-height:180px;padding:8px;gap:3px;} .play-rack-row{gap:2px;} .slot{width:35px;height:35px;font-size:0.9rem;} #dragging-tile{width:35px;height:35px;} .board{grid-template-columns:repeat(22,20px);grid-template-rows:repeat(22,20px);width:calc(22 * 20px);height:calc(22 * 20px);} .board-cell{width:20px;height:20px;font-size:0.6rem;} .turn-time-display{font-size:1.3rem;} .applause-text{font-size:1.5rem;} .applause-emoji{font-size:2rem;} }
    </style>
</head>
<body>
    <!-- HTML structure exactly as original (preserved) -->
    <div class="game-container">
        <div class="header">
            <div id="playDurationControl"><div class="duration-label">Game Time:</div><button class="duration-btn" id="decreaseDuration">‚àí</button><div class="duration-time" id="durationDisplay">30:00</div><button class="duration-btn" id="increaseDuration">+</button></div>
            <div><h1><span class="title-latin">Words War</span><span class="title-separator">-</span><span class="title-arabic">ÿ≠ÿ±ÿ® ÿßŸÑŸÉŸÑŸÖÿßÿ™</span></h1><div class="copyright">Copyright and Design right 2000 & 2026. Prof. Abdelmalek Bouhadjera</div></div>
            <button class="control-btn" id="newGameBtnTop"><span>üîÑ</span> New Game / ŸÑÿπÿ®ÿ© ÿ¨ÿØŸäÿØÿ©</button>
        </div>
        <div class="main-game-area">
            <div class="top-game-area">
                <div class="player-panel latin-panel"><div class="panel-content"><div class="panel-header latin-header" id="latin-header"><span class="turn-indicator-dot" id="latin-turn-dot"></span>Latin Player</div><div class="player-status"><div class="status-item"><span class="status-label">Tiles in Bag:</span><span class="status-value" id="latin-bag-count">75</span></div><div class="status-item"><span class="status-label">Game Phase:</span><span class="status-value" id="latin-game-phase">Draw 1</span></div><div class="status-item"><span class="status-label">Columns Reached:</span><span class="status-value" id="latin-columns-reached">0</span></div></div><div class="turn-time-counter"><div class="turn-time-label">Turn Time:</div><div class="turn-time-display" id="latin-turn-timer">00:00</div></div><div class="draw-buttons"><button class="draw-btn draw-1" id="latin-draw-1-btn">Draw 1</button><button class="draw-btn draw-6" id="latin-draw-6-btn" disabled>Draw 6</button><button class="draw-btn draw-3" id="latin-draw-3-btn" disabled>Draw 3</button></div><div class="play-racks-container"><div class="play-rack-wrapper"><div class="play-rack-label">Letters Area</div><div class="play-rack" id="latin-play-rack"></div></div></div></div></div>
                <div class="board-panel"><div class="board-frame"><div class="board-container"><div class="board" id="game-board"></div></div></div></div>
                <div class="player-panel arabic-panel"><div class="panel-content"><div class="panel-header arabic-header" id="arabic-header">ÿßŸÑŸÑÿßÿπÿ® ÿßŸÑÿπÿ±ÿ®Ÿä<span class="turn-indicator-dot" id="arabic-turn-dot"></span></div><div class="player-status"><div class="status-item"><span class="status-value" id="arabic-bag-count">75</span><span class="status-label">ÿßŸÑŸÇÿ∑ÿπ ŸÅŸä ÿßŸÑŸÉŸäÿ≥:</span></div><div class="status-item"><span class="status-value" id="arabic-game-phase">ÿ≥ÿ≠ÿ®1</span><span class="status-label">ŸÖÿ±ÿ≠ŸÑÿ© ÿßŸÑŸÑÿπÿ®ÿ©:</span></div><div class="status-item"><span class="status-value" id="arabic-columns-reached">0</span><span class="status-label">ÿßŸÑÿ£ÿπŸÖÿØÿ© ÿßŸÑÿ™Ÿä ŸàÿµŸÑÿ™:</span></div></div><div class="turn-time-counter"><div class="turn-time-label">ŸàŸÇÿ™ ÿßŸÑÿØŸàÿ±:</div><div class="turn-time-display" id="arabic-turn-timer">00:00</div></div><div class="draw-buttons"><button class="draw-btn draw-1" id="arabic-draw-1-btn">ÿ≥ÿ≠ÿ® 1</button><button class="draw-btn draw-6" id="arabic-draw-6-btn" disabled>ÿ≥ÿ≠ÿ® 6</button><button class="draw-btn draw-3" id="arabic-draw-3-btn" disabled>ÿ≥ÿ≠ÿ® 3</button></div><div class="play-racks-container"><div class="play-rack-wrapper"><div class="play-rack-label">ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≠ÿ±ŸàŸÅ</div><div class="play-rack" id="arabic-play-rack"></div></div></div></div></div>
            </div>
            <div class="bottom-game-area"><div class="experiment-racks-container"><div class="experiment-rack-wrapper" id="latin-experiment-rack-wrapper"><div class="experiment-rack-label">Word Formation Area</div><div class="experiment-rack" id="latin-experiment-rack"></div></div><div class="experiment-rack-wrapper" id="arabic-experiment-rack-wrapper"><div class="experiment-rack-label">ŸÖŸÜÿ∑ŸÇÿ© ÿ™ŸÉŸàŸäŸÜ ÿßŸÑŸÉŸÑŸÖÿßÿ™</div><div class="experiment-rack" id="arabic-experiment-rack"></div></div></div></div>
        </div>
    </div>
    <div id="dragging-tile"></div>
    <div class="message-display" id="message-display"></div>
    <div class="applause-overlay" id="applauseOverlay"><div class="applause-container"><div class="applause-text" id="applauseText"></div><div class="applause-emoji" id="applauseEmoji">üëèüëèüëè</div><div class="time-over-message" id="timeOverMessage"></div><div class="stats-display" id="statsDisplay"></div></div></div>

    <script>
        // ========== TILE BAGS (exactly as original) ==========
        const ARABIC_BAG = [
            { arabicLetter: 'ÿß', latinLetter: 'A', value: 1, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿß', latinLetter: 'A', value: 1, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿß', latinLetter: 'A', value: 1, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿß', latinLetter: 'A', value: 1, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿß', latinLetter: 'A', value: 1, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿß', latinLetter: 'A', value: 1, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿ°', latinLetter: null, value: 4, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿ°', latinLetter: null, value: 4, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿ°', latinLetter: null, value: 4, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿ°', latinLetter: null, value: 4, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿ®', latinLetter: 'B', value: 3, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿ®', latinLetter: 'B', value: 3, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿ®', latinLetter: 'B', value: 3, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿ™', latinLetter: 'T', value: 3, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿ™', latinLetter: 'T', value: 3, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿ™', latinLetter: 'T', value: 3, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿ™', latinLetter: 'T', value: 3, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿ´', latinLetter: null, value: 5, color: '#9b59b6', isArabic: true },
            { arabicLetter: 'ÿ¨', latinLetter: 'J', value: 3, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿ¨', latinLetter: 'J', value: 3, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿØ', latinLetter: 'D', value: 2, color: '#e67e22', isArabic: true },
            { arabicLetter: 'ÿØ', latinLetter: 'D', value: 2, color: '#e67e22', isArabic: true },
            { arabicLetter: 'ÿ∞', latinLetter: null, value: 5, color: '#c0392b', isArabic: true },
            { arabicLetter: 'Ÿá', latinLetter: null, value: 2, color: '#e74c3c', isArabic: true },
            { arabicLetter: 'ÿÆ', latinLetter: null, value: 5, color: '#3498db', isArabic: true },
            { arabicLetter: 'ÿ±', latinLetter: 'R', value: 2, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿ±', latinLetter: 'R', value: 2, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿ±', latinLetter: 'R', value: 2, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿ≤', latinLetter: null, value: 4, color: '#9b59b6', isArabic: true },
            { arabicLetter: 'ÿ≥', latinLetter: 'S', value: 2, color: '#e67e22', isArabic: true },
            { arabicLetter: 'ÿ≥', latinLetter: 'S', value: 2, color: '#e67e22', isArabic: true },
            { arabicLetter: 'ÿ≥', latinLetter: 'S', value: 2, color: '#e67e22', isArabic: true },
            { arabicLetter: 'ÿ¥', latinLetter: null, value: 4, color: '#c0392b', isArabic: true },
            { arabicLetter: 'ÿµ', latinLetter: null, value: 4, color: '#e74c3c', isArabic: true },
            { arabicLetter: 'ÿµ', latinLetter: null, value: 4, color: '#e74c3c', isArabic: true },
            { arabicLetter: 'ÿ∂', latinLetter: null, value: 6, color: '#3498db', isArabic: true },
            { arabicLetter: 'ÿ∑', latinLetter: null, value: 4, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ÿ∏', latinLetter: null, value: 6, color: '#9b59b6', isArabic: true },
            { arabicLetter: 'ÿπ', latinLetter: null, value: 2, color: '#e67e22', isArabic: true },
            { arabicLetter: 'ÿπ', latinLetter: null, value: 2, color: '#e67e22', isArabic: true },
            { arabicLetter: 'ÿπ', latinLetter: null, value: 2, color: '#e67e22', isArabic: true },
            { arabicLetter: 'ÿ∫', latinLetter: 'G', value: 6, color: '#c0392b', isArabic: true },
            { arabicLetter: 'ŸÅ', latinLetter: 'F', value: 3, color: '#e74c3c', isArabic: true },
            { arabicLetter: 'ŸÅ', latinLetter: 'F', value: 3, color: '#e74c3c', isArabic: true },
            { arabicLetter: 'ŸÇ', latinLetter: 'Q', value: 5, color: '#3498db', isArabic: true },
            { arabicLetter: 'ŸÇ', latinLetter: 'Q', value: 5, color: '#3498db', isArabic: true },
            { arabicLetter: 'ŸÉ', latinLetter: 'K', value: 3, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ŸÉ', latinLetter: 'K', value: 3, color: '#27ae60', isArabic: true },
            { arabicLetter: 'ŸÑ', latinLetter: 'L', value: 2, color: '#9b59b6', isArabic: true },
            { arabicLetter: 'ŸÑ', latinLetter: 'L', value: 2, color: '#9b59b6', isArabic: true },
            { arabicLetter: 'ŸÑ', latinLetter: 'L', value: 2, color: '#9b59b6', isArabic: true },
            { arabicLetter: 'ŸÑ', latinLetter: 'L', value: 2, color: '#9b59b6', isArabic: true },
            { arabicLetter: 'ŸÑ', latinLetter: 'L', value: 2, color: '#9b59b6', isArabic: true },
            { arabicLetter: 'ŸÑ', latinLetter: 'L', value: 2, color: '#9b59b6', isArabic: true },
            { arabicLetter: 'ŸÖ', latinLetter: 'M', value: 2, color: '#e67e22', isArabic: true },
            { arabicLetter: 'ŸÖ', latinLetter: 'M', value: 2, color: '#e67e22', isArabic: true },
            { arabicLetter: 'ŸÖ', latinLetter: 'M', value: 2, color: '#e67e22', isArabic: true },
            { arabicLetter: 'ŸÖ', latinLetter: 'M', value: 2, color: '#e67e22', isArabic: true },
            { arabicLetter: 'ŸÜ', latinLetter: 'N', value: 2, color: '#c0392b', isArabic: true },
            { arabicLetter: 'ŸÜ', latinLetter: 'N', value: 2, color: '#c0392b', isArabic: true },
            { arabicLetter: 'ŸÜ', latinLetter: 'N', value: 2, color: '#c0392b', isArabic: true },
            { arabicLetter: 'ŸÜ', latinLetter: 'N', value: 2, color: '#c0392b', isArabic: true },
            { arabicLetter: 'ŸÜ', latinLetter: 'N', value: 2, color: '#c0392b', isArabic: true },
            { arabicLetter: 'ÿ≠', latinLetter: 'H', value: 4, color: '#e74c3c', isArabic: true },
            { arabicLetter: 'ÿ≠', latinLetter: 'H', value: 4, color: '#e74c3c', isArabic: true },
            { arabicLetter: 'Ÿà', latinLetter: 'O', value: 2, color: '#3498db', isArabic: true },
            { arabicLetter: 'Ÿà', latinLetter: 'O', value: 2, color: '#3498db', isArabic: true },
            { arabicLetter: 'Ÿà', latinLetter: 'O', value: 2, color: '#3498db', isArabic: true },
            { arabicLetter: 'Ÿà', latinLetter: 'O', value: 2, color: '#3498db', isArabic: true },
            { arabicLetter: 'Ÿä', latinLetter: 'Y', value: 2, color: '#27ae60', isArabic: true },
            { arabicLetter: 'Ÿä', latinLetter: 'Y', value: 2, color: '#27ae60', isArabic: true },
            { arabicLetter: 'Ÿä', latinLetter: 'Y', value: 2, color: '#27ae60', isArabic: true },
            { arabicLetter: 'Ÿä', latinLetter: 'Y', value: 2, color: '#27ae60', isArabic: true },
            { arabicLetter: '', latinLetter: '', value: 0, color: '#27ae60', isArabic: true, isBlank: true },
            { arabicLetter: '', latinLetter: '', value: 0, color: '#27ae60', isArabic: true, isBlank: true }
        ];

        const LATIN_BAG = [
            { latinLetter: 'A', arabicLetter: 'ÿß', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'A', arabicLetter: 'ÿß', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'A', arabicLetter: 'ÿß', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'A', arabicLetter: 'ÿß', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'A', arabicLetter: 'ÿß', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'A', arabicLetter: 'ÿß', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'A', arabicLetter: 'ÿß', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'B', arabicLetter: 'ÿ®', value: 3, color: '#27ae60', isArabic: false },
            { latinLetter: 'B', arabicLetter: 'ÿ®', value: 3, color: '#27ae60', isArabic: false },
            { latinLetter: 'C', arabicLetter: null, value: 3, color: '#27ae60', isArabic: false },
            { latinLetter: 'C', arabicLetter: null, value: 3, color: '#27ae60', isArabic: false },
            { latinLetter: 'D', arabicLetter: 'ÿØ', value: 2, color: '#9b59b6', isArabic: false },
            { latinLetter: 'D', arabicLetter: 'ÿØ', value: 2, color: '#9b59b6', isArabic: false },
            { latinLetter: 'E', arabicLetter: null, value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'E', arabicLetter: null, value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'E', arabicLetter: null, value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'E', arabicLetter: null, value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'E', arabicLetter: null, value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'E', arabicLetter: null, value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'E', arabicLetter: null, value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'F', arabicLetter: 'ŸÅ', value: 4, color: '#e67e22', isArabic: false },
            { latinLetter: 'F', arabicLetter: 'ŸÅ', value: 4, color: '#e67e22', isArabic: false },
            { latinLetter: 'G', arabicLetter: 'ÿ∫', value: 2, color: '#9b59b6', isArabic: false },
            { latinLetter: 'G', arabicLetter: 'ÿ∫', value: 2, color: '#9b59b6', isArabic: false },
            { latinLetter: 'H', arabicLetter: 'ÿ≠', value: 4, color: '#e67e22', isArabic: false },
            { latinLetter: 'H', arabicLetter: 'ÿ≠', value: 4, color: '#e67e22', isArabic: false },
            { latinLetter: 'H', arabicLetter: 'ÿ≠', value: 4, color: '#e67e22', isArabic: false },
            { latinLetter: 'I', arabicLetter: null, value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'I', arabicLetter: null, value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'I', arabicLetter: null, value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'I', arabicLetter: null, value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'I', arabicLetter: null, value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'J', arabicLetter: 'ÿ¨', value: 8, color: '#c0392b', isArabic: false },
            { latinLetter: 'K', arabicLetter: 'ŸÉ', value: 5, color: '#e74c3c', isArabic: false },
            { latinLetter: 'L', arabicLetter: 'ŸÑ', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'L', arabicLetter: 'ŸÑ', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'L', arabicLetter: 'ŸÑ', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'M', arabicLetter: 'ŸÖ', value: 3, color: '#27ae60', isArabic: false },
            { latinLetter: 'M', arabicLetter: 'ŸÖ', value: 3, color: '#27ae60', isArabic: false },
            { latinLetter: 'N', arabicLetter: 'ŸÜ', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'N', arabicLetter: 'ŸÜ', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'N', arabicLetter: 'ŸÜ', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'N', arabicLetter: 'ŸÜ', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'O', arabicLetter: 'Ÿà', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'O', arabicLetter: 'Ÿà', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'O', arabicLetter: 'Ÿà', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'O', arabicLetter: 'Ÿà', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'O', arabicLetter: 'Ÿà', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'P', arabicLetter: null, value: 3, color: '#27ae60', isArabic: false },
            { latinLetter: 'P', arabicLetter: null, value: 3, color: '#27ae60', isArabic: false },
            { latinLetter: 'Q', arabicLetter: null, value: 10, color: '#2c3e50', isArabic: false },
            { latinLetter: 'R', arabicLetter: 'ÿ±', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'R', arabicLetter: 'ÿ±', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'R', arabicLetter: 'ÿ±', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'S', arabicLetter: 'ÿ≥', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'S', arabicLetter: 'ÿ≥', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'S', arabicLetter: 'ÿ≥', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'S', arabicLetter: 'ÿ≥', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'T', arabicLetter: 'ÿ™', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'T', arabicLetter: 'ÿ™', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'T', arabicLetter: 'ÿ™', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'T', arabicLetter: 'ÿ™', value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'U', arabicLetter: null, value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'U', arabicLetter: null, value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'U', arabicLetter: null, value: 1, color: '#3498db', isArabic: false },
            { latinLetter: 'V', arabicLetter: null, value: 4, color: '#e67e22', isArabic: false },
            { latinLetter: 'V', arabicLetter: null, value: 4, color: '#e67e22', isArabic: false },
            { latinLetter: 'W', arabicLetter: null, value: 4, color: '#e67e22', isArabic: false },
            { latinLetter: 'W', arabicLetter: null, value: 4, color: '#e67e22', isArabic: false },
            { latinLetter: 'X', arabicLetter: null, value: 8, color: '#c0392b', isArabic: false },
            { latinLetter: 'Y', arabicLetter: 'Ÿä', value: 4, color: '#e67e22', isArabic: false },
            { latinLetter: 'Y', arabicLetter: 'Ÿä', value: 4, color: '#e67e22', isArabic: false },
            { latinLetter: 'Z', arabicLetter: 'ÿ≤', value: 10, color: '#2c3e50', isArabic: false },
            { latinLetter: '', arabicLetter: '', value: 0, color: '#3498db', isArabic: false, isBlank: true },
            { latinLetter: '', arabicLetter: '', value: 0, color: '#3498db', isArabic: false, isBlank: true }
        ];

        // ========== SOUND SYSTEM (unchanged) ==========
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx = null;

        function playSound(type) {
            if (!AudioContext) return;
            try {
                if (!audioCtx) audioCtx = new AudioContext();
                if (audioCtx.state === 'suspended') audioCtx.resume();
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                gain.gain.value = 0.15;

                const now = audioCtx.currentTime;
                switch(type) {
                    case 'draw':
                        osc.type = 'triangle';
                        osc.frequency.setValueAtTime(300, now);
                        osc.frequency.exponentialRampToValueAtTime(600, now + 0.15);
                        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                        osc.start(now);
                        osc.stop(now + 0.2);
                        break;
                    case 'pickup':
                        osc.type = 'sine';
                        osc.frequency.setValueAtTime(440, now);
                        osc.frequency.exponentialRampToValueAtTime(220, now + 0.1);
                        gain.gain.setValueAtTime(0.2, now);
                        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
                        osc.start(now);
                        osc.stop(now + 0.15);
                        break;
                    case 'rack':
                        osc.type = 'square';
                        osc.frequency.setValueAtTime(120, now);
                        gain.gain.setValueAtTime(0.1, now);
                        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                        osc.start(now);
                        osc.stop(now + 0.1);
                        break;
                    case 'board':
                        osc.type = 'sawtooth';
                        osc.frequency.setValueAtTime(80, now);
                        gain.gain.setValueAtTime(0.2, now);
                        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                        osc.start(now);
                        osc.stop(now + 0.2);
                        break;
                    default: break;
                }
            } catch (e) { console.log("Sound error", e); }
        }

        // ========== GAME STATE ==========
        let gameState = {
            currentPlayer: 'latin', gamePhase: 'draw1',
            latinPlayRack: Array(20).fill(null), latinExperimentRack: Array(10).fill(null), latinBag: [], latinScore: 0, latinTilesPlaced: 0, latinDrawnTile: null,
            arabicPlayRack: Array(20).fill(null), arabicExperimentRack: Array(10).fill(null), arabicBag: [], arabicScore: 0, arabicTilesPlaced: 0, arabicDrawnTile: null,
            board: Array(22).fill().map(() => Array(22).fill(null)),
            draggedTile: null, draggedFrom: null, isDragging: false, lastPlayedWord: null, currentTurn: 1,
            draw1Completed: false, startingPlayerDetermined: false, gameOver: false, winner: null,
            gameStartTime: null, gameDuration: 30*60, gameTimeRemaining: 30*60, timeOver: false,
            latinColumnsReached: 0, arabicColumnsReached: 0
        };

        // Timer variables
        let latinTurnTimer = 0, arabicTurnTimer = 0, currentTimerInterval = null, timerActive = false, gameTimerInterval = null;

        // DOM elements
        const draggingTileEl = document.getElementById('dragging-tile');
        const latinTurnDot = document.getElementById('latin-turn-dot'), arabicTurnDot = document.getElementById('arabic-turn-dot');
        const latinHeader = document.getElementById('latin-header'), arabicHeader = document.getElementById('arabic-header');
        const messageDisplay = document.getElementById('message-display');
        const applauseOverlay = document.getElementById('applauseOverlay'), applauseText = document.getElementById('applauseText');
        const applauseEmoji = document.getElementById('applauseEmoji'), timeOverMessage = document.getElementById('timeOverMessage');
        const statsDisplay = document.getElementById('statsDisplay');
        const latinDraw1Btn = document.getElementById('latin-draw-1-btn'), latinDraw6Btn = document.getElementById('latin-draw-6-btn'), latinDraw3Btn = document.getElementById('latin-draw-3-btn');
        const arabicDraw1Btn = document.getElementById('arabic-draw-1-btn'), arabicDraw6Btn = document.getElementById('arabic-draw-6-btn'), arabicDraw3Btn = document.getElementById('arabic-draw-3-btn');
        const durationDisplay = document.getElementById('durationDisplay'), decreaseDurationBtn = document.getElementById('decreaseDuration'), increaseDurationBtn = document.getElementById('increaseDuration');
        const gameBoard = document.getElementById('game-board');
        const whiteColumns = [1,3,5,7,9,12,14,16,18,20];
        const LATIN_ALPHABET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const ARABIC_ALPHABET = 'ÿßÿ®ÿ™ÿ´ÿ¨ÿ≠ÿÆÿØÿ∞ÿ±ÿ≤ÿ≥ÿ¥ÿµÿ∂ÿ∑ÿ∏ÿπÿ∫ŸÅŸÇŸÉŸÑŸÖŸÜŸáŸàŸä';

        // ========== BILINGUAL INSTRUCTION HELPER ==========
        function showBilingualMessage(enText, arText, duration = 4000) {
            messageDisplay.innerHTML = `<div style="direction:ltr; margin-bottom:5px;">üî§ ${enText}</div><div style="direction:rtl; color:#27ae60;">üïã ${arText}</div>`;
            messageDisplay.style.display = 'block';
            setTimeout(() => messageDisplay.style.display = 'none', duration);
        }

        // override original showMessage to bilingual
        window.showMessage = function(en, ar, d = 4000) {
            showBilingualMessage(en, ar, d);
        }

        // ========== ALL ORIGINAL FUNCTIONS (preserved, but showMessage replaced) ==========
        function initGame() {
            gameState = {
                currentPlayer: 'latin', gamePhase: 'draw1',
                latinPlayRack: Array(20).fill(null), latinExperimentRack: Array(10).fill(null), latinBag: [], latinScore: 0, latinTilesPlaced: 0, latinDrawnTile: null,
                arabicPlayRack: Array(20).fill(null), arabicExperimentRack: Array(10).fill(null), arabicBag: [], arabicScore: 0, arabicTilesPlaced: 0, arabicDrawnTile: null,
                board: Array(22).fill().map(() => Array(22).fill(null)),
                draggedTile: null, draggedFrom: null, isDragging: false, lastPlayedWord: null, currentTurn: 1,
                draw1Completed: false, startingPlayerDetermined: false, gameOver: false, winner: null,
                gameStartTime: null, gameDuration: 30*60, gameTimeRemaining: 30*60, timeOver: false,
                latinColumnsReached: 0, arabicColumnsReached: 0
            };
            resetTimers(); stopGameTimer();
            draggingTileEl.style.display = 'none'; messageDisplay.style.display = 'none'; applauseOverlay.style.display = 'none';
            createRackSlots(); createBoard(); fillTileBags(); updateGameDisplay(); updateButtonStates(); updateDurationDisplay();
            setupEventListeners();
            showBilingualMessage(
                "Game started! Click a tile to pick it up (it will stick to cursor). Click again to place.",
                "ÿ®ÿØÿ£ÿ™ ÿßŸÑŸÑÿπÿ®ÿ©! ÿßŸÜŸÇÿ± ÿπŸÑŸâ ŸÇÿ∑ÿπÿ© ŸÑÿßŸÑÿ™ŸÇÿßÿ∑Ÿáÿß (ÿ™ŸÑÿ™ÿµŸÇ ÿ®ÿßŸÑŸÖÿ§ÿ¥ÿ±). ÿßŸÜŸÇÿ± ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ ŸÑŸàÿ∂ÿπŸáÿß.",
                6000
            );
        }

        function createRackSlots() {
            createPlayRackSlots('latin-play-rack', 'play', 'latin');
            createExperimentRackSlots('latin-experiment-rack', 'experiment', 'latin');
            createPlayRackSlots('arabic-play-rack', 'play', 'arabic');
            createExperimentRackSlots('arabic-experiment-rack', 'experiment', 'arabic');
        }

        function createPlayRackSlots(containerId, rackType, player) {
            const container = document.getElementById(containerId); container.innerHTML = '';
            for (let r = 0; r < 4; r++) {
                const row = document.createElement('div'); row.className = 'play-rack-row';
                for (let c = 0; c < 5; c++) {
                    const idx = r * 5 + c; const slot = document.createElement('div'); slot.className = 'slot empty';
                    slot.dataset.index = idx; slot.dataset.rack = rackType; slot.dataset.player = player;
                    row.appendChild(slot);
                }
                container.appendChild(row);
            }
        }

        function createExperimentRackSlots(containerId, rackType, player) {
            const container = document.getElementById(containerId); container.innerHTML = '';
            for (let i = 0; i < 10; i++) {
                const slot = document.createElement('div'); slot.className = 'slot empty';
                slot.dataset.index = i; slot.dataset.rack = rackType; slot.dataset.player = player;
                container.appendChild(slot);
            }
        }

        function createBoard() {
            gameBoard.innerHTML = '';
            for (let r = 0; r < 22; r++) {
                for (let c = 0; c < 22; c++) {
                    const cell = document.createElement('div'); cell.className = 'board-cell';
                    cell.dataset.row = r; cell.dataset.col = c;
                    applyColumnColor(cell, c);
                    if ((r === 11 && c === 0) || (r === 10 && c === 21)) cell.classList.add('special-red');
                    gameBoard.appendChild(cell);
                }
            }
        }

        function applyColumnColor(cell, col) {
            if (whiteColumns.includes(col)) cell.classList.add('white-column');
            else if (col < 11) cell.classList.add('latin-colored');
            else cell.classList.add('arabic-colored');
        }

        function fillTileBags() {
            gameState.latinBag = [...LATIN_BAG].map((tile, index) => ({ ...tile, id: `latin-${tile.latinLetter || 'blank'}-${index}-${Date.now()}`, player: 'latin' }));
            shuffleArray(gameState.latinBag);
            gameState.arabicBag = [...ARABIC_BAG].map((tile, index) => ({ ...tile, id: `arabic-${tile.arabicLetter || 'blank'}-${index}-${Date.now()}`, player: 'arabic' }));
            shuffleArray(gameState.arabicBag);
        }

        function startTimer() {
            if (timerActive) return;
            timerActive = true;
            currentTimerInterval = setInterval(() => {
                if (gameState.currentPlayer === 'latin') { latinTurnTimer++; updateTimerDisplay('latin', latinTurnTimer); }
                else { arabicTurnTimer++; updateTimerDisplay('arabic', arabicTurnTimer); }
            }, 1000);
        }

        function stopTimer() {
            if (!timerActive) return;
            timerActive = false; if (currentTimerInterval) { clearInterval(currentTimerInterval); currentTimerInterval = null; }
        }

        function resetTimers() { latinTurnTimer = 0; arabicTurnTimer = 0; updateTimerDisplay('latin', 0); updateTimerDisplay('arabic', 0); }

        function updateTimerDisplay(p, s) {
            const m = Math.floor(s / 60); const rs = s % 60; const f = `${m.toString().padStart(2, '0')}:${rs.toString().padStart(2, '0')}`;
            document.getElementById(p === 'latin' ? 'latin-turn-timer' : 'arabic-turn-timer').textContent = f;
        }

        function startGameTimer() {
            if (gameTimerInterval) clearInterval(gameTimerInterval);
            gameState.gameStartTime = Date.now(); gameState.gameTimeRemaining = gameState.gameDuration;
            gameTimerInterval = setInterval(() => {
                if (gameState.gamePhase === 'play' && !gameState.gameOver) {
                    const elapsed = Math.floor((Date.now() - gameState.gameStartTime) / 1000);
                    gameState.gameTimeRemaining = Math.max(0, gameState.gameDuration - elapsed); updateDurationDisplay();
                    if (gameState.gameTimeRemaining <= 0 && !gameState.timeOver) { gameState.timeOver = true; handleTimeOver(); }
                }
            }, 1000);
        }

        function stopGameTimer() { if (gameTimerInterval) { clearInterval(gameTimerInterval); gameTimerInterval = null; } }

        function updateDurationDisplay() {
            const m = Math.floor(gameState.gameTimeRemaining / 60); const s = gameState.gameTimeRemaining % 60;
            durationDisplay.textContent = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
            if (gameState.gameTimeRemaining <= 60) durationDisplay.style.color = '#e74c3c';
            else if (gameState.gameTimeRemaining <= 300) durationDisplay.style.color = '#f39c12';
            else durationDisplay.style.color = '#3498db';
        }

        function handleTimeOver() { stopTimer(); stopGameTimer(); calculatePlayerProgress(); determineTimeOverWinner(); showApplauseOverlay(); }

        // ========== FIXED calculatePlayerProgress ==========
        // Now counts correctly: latin tracks from col 0 to 21 (max 22), arabic from col 21 to 0 (max 22)
        function calculatePlayerProgress() {
            gameState.latinColumnsReached = 0;
            gameState.arabicColumnsReached = 0;

            // Latin progress: furthest column (0-21) where any Latin tile exists. If a tile in col 21, latinColumnsReached = 22.
            for (let c = 0; c < 22; c++) {
                for (let r = 0; r < 22; r++) {
                    const tile = gameState.board[r][c];
                    if (tile && tile.player === 'latin') {
                        gameState.latinColumnsReached = Math.max(gameState.latinColumnsReached, c + 1); // column index 21 ‚Üí 22
                        break; // no need to check further rows in this column
                    }
                }
            }

            // Arabic progress: furthest column from right side (index 21 down to 0)
            for (let c = 21; c >= 0; c--) {
                for (let r = 0; r < 22; r++) {
                    const tile = gameState.board[r][c];
                    if (tile && tile.player === 'arabic') {
                        // distance from right edge: (21 - c + 1) = 22 - c
                        const distFromRight = 22 - c; // if c=21 ‚Üí 1, c=20 ‚Üí2, ..., c=0 ‚Üí22
                        gameState.arabicColumnsReached = Math.max(gameState.arabicColumnsReached, distFromRight);
                        break;
                    }
                }
            }
        }

        function determineTimeOverWinner() {
            if (gameState.winner) return;
            if (gameState.latinColumnsReached > gameState.arabicColumnsReached) { gameState.winner = 'latin'; gameState.gameOver = true; }
            else if (gameState.arabicColumnsReached > gameState.latinColumnsReached) { gameState.winner = 'arabic'; gameState.gameOver = true; }
            else if (gameState.latinTilesPlaced > gameState.arabicTilesPlaced) { gameState.winner = 'latin'; gameState.gameOver = true; }
            else if (gameState.arabicTilesPlaced > gameState.latinTilesPlaced) { gameState.winner = 'arabic'; gameState.gameOver = true; }
            else { gameState.winner = 'latin'; gameState.gameOver = true; }
        }

        function showApplauseOverlay() {
            let msg = gameState.winner === 'latin' ? "üèÜ VICTORY! / ÿßŸÑŸÜÿµÿ±!" : "üèÜ ÿßŸÑŸÜÿµÿ±! / VICTORY!";
            applauseText.textContent = msg; applauseEmoji.textContent = 'üéâüëèüéâ'; statsDisplay.innerHTML = ''; timeOverMessage.textContent = gameState.timeOver ? "TIME'S UP! / ÿßŸÜÿ™ŸáŸâ ÿßŸÑŸàŸÇÿ™!" : "";
            applauseOverlay.style.display = 'flex'; playVictorySound(); setTimeout(() => applauseOverlay.style.display = 'none', 15000);
        }

        function playVictorySound() {
            try { if (!audioCtx) audioCtx = new AudioContext();
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
                        osc.connect(gain); gain.connect(audioCtx.destination); gain.gain.value = 0.15;
                        osc.frequency.setValueAtTime(400 + Math.random() * 400, audioCtx.currentTime);
                        osc.frequency.exponentialRampToValueAtTime(200, audioCtx.currentTime + 0.8);
                        osc.type = 'sawtooth'; gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.8);
                        osc.start(); osc.stop(audioCtx.currentTime + 0.8);
                    }, i * 200);
                }
            } catch (e) { console.log("Victory sound error"); }
        }

        function updateGameDisplay() {
            if (gameState.currentPlayer === 'latin') {
                latinTurnDot.style.display = 'inline-block'; arabicTurnDot.style.display = 'none';
                latinHeader.style.backgroundColor = '#f0f7ff'; arabicHeader.style.backgroundColor = 'white';
            } else {
                latinTurnDot.style.display = 'none'; arabicTurnDot.style.display = 'inline-block';
                latinHeader.style.backgroundColor = 'white'; arabicHeader.style.backgroundColor = '#f0f7ff';
            }
            document.getElementById('latin-bag-count').textContent = gameState.latinBag.length;
            document.getElementById('latin-columns-reached').textContent = gameState.latinColumnsReached;
            document.getElementById('arabic-bag-count').textContent = gameState.arabicBag.length;
            document.getElementById('arabic-columns-reached').textContent = gameState.arabicColumnsReached;
            let phase = gameState.gamePhase, aphase = 'ÿ≥ÿ≠ÿ®1';
            if (phase === 'draw1') { phase = 'Draw 1'; aphase = 'ÿ≥ÿ≠ÿ®1'; }
            else if (phase === 'draw6') { phase = 'Draw 6'; aphase = 'ÿ≥ÿ≠ÿ®6'; }
            else if (phase === 'play') { phase = 'Playing'; aphase = 'ŸäŸÑÿπÿ®'; }
            else { phase = 'Game Over'; aphase = 'ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑŸÑÿπÿ®ÿ©'; }
            document.getElementById('latin-game-phase').textContent = phase;
            document.getElementById('arabic-game-phase').textContent = aphase;
            updatePlayRackDisplay('latin-play-rack', gameState.latinPlayRack, 'play', 'latin');
            updateExperimentRackDisplay('latin-experiment-rack', gameState.latinExperimentRack, 'experiment', 'latin');
            updatePlayRackDisplay('arabic-play-rack', gameState.arabicPlayRack, 'play', 'arabic');
            updateExperimentRackDisplay('arabic-experiment-rack', gameState.arabicExperimentRack, 'experiment', 'arabic');
            updateBoardDisplay(); checkVictoryCondition(); calculatePlayerProgress(); // recalc each update
        }

        function updateButtonStates() {
            latinDraw1Btn.disabled = false; latinDraw6Btn.disabled = true; latinDraw3Btn.disabled = true;
            arabicDraw1Btn.disabled = false; arabicDraw6Btn.disabled = true; arabicDraw3Btn.disabled = true;
            if (gameState.gamePhase === 'draw1') {
                if (gameState.latinDrawnTile) latinDraw1Btn.disabled = true;
                if (gameState.arabicDrawnTile) arabicDraw1Btn.disabled = true;
                if (gameState.latinDrawnTile && gameState.arabicDrawnTile && !gameState.startingPlayerDetermined) setTimeout(determineStartingPlayer, 100);
            } else if (gameState.gamePhase === 'draw6') {
                latinDraw1Btn.disabled = true; latinDraw6Btn.disabled = false; arabicDraw1Btn.disabled = true; arabicDraw6Btn.disabled = false;
            } else if (gameState.gamePhase === 'play') {
                latinDraw1Btn.disabled = true; latinDraw6Btn.disabled = true; arabicDraw1Btn.disabled = true; arabicDraw6Btn.disabled = true;
                if (gameState.currentPlayer === 'latin') latinDraw3Btn.disabled = false; else arabicDraw3Btn.disabled = false;
            }
            if (gameState.gameOver) {
                latinDraw1Btn.disabled = true; latinDraw6Btn.disabled = true; latinDraw3Btn.disabled = true;
                arabicDraw1Btn.disabled = true; arabicDraw6Btn.disabled = true; arabicDraw3Btn.disabled = true;
            }
        }

        function determineStartingPlayer() {
            const latinTile = gameState.latinDrawnTile, arabicTile = gameState.arabicDrawnTile;
            const latinLetter = latinTile.latinLetter || '', arabicLetter = arabicTile.arabicLetter || '';
            const latinPos = LATIN_ALPHABET.indexOf(latinLetter.toUpperCase()), arabicPos = ARABIC_ALPHABET.indexOf(arabicLetter);
            if (latinPos !== -1 && arabicPos !== -1) {
                if (latinPos < arabicPos) { gameState.currentPlayer = 'latin'; showBilingualMessage(`Latin starts!`, 'ÿßŸÑŸÑÿßÿ™ŸäŸÜŸäÿ© ÿ™ÿ®ÿØÿ£!'); }
                else if (arabicPos < latinPos) { gameState.currentPlayer = 'arabic'; showBilingualMessage(`Arabic starts!`, 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ÿ™ÿ®ÿØÿ£!'); }
                else {
                    showBilingualMessage(`Same position, redraw!`, 'ŸÜŸÅÿ≥ ÿßŸÑŸÖÿ±ŸÉÿ≤ÿå ÿ•ÿπÿßÿØÿ© ÿ≥ÿ≠ÿ®!'); gameState.latinBag.push(latinTile); gameState.arabicBag.push(arabicTile);
                    shuffleArray(gameState.latinBag); shuffleArray(gameState.arabicBag); gameState.latinDrawnTile = null; gameState.arabicDrawnTile = null;
                    updateGameDisplay(); updateButtonStates(); return;
                }
            } else {
                if (latinLetter < arabicLetter) gameState.currentPlayer = 'latin'; else gameState.currentPlayer = 'arabic';
            }
            gameState.latinBag.push(latinTile); gameState.arabicBag.push(arabicTile); shuffleArray(gameState.latinBag); shuffleArray(gameState.arabicBag);
            gameState.latinDrawnTile = null; gameState.arabicDrawnTile = null; gameState.startingPlayerDetermined = true; gameState.gamePhase = 'draw6';
            updateGameDisplay(); updateButtonStates(); showBilingualMessage("Starting player determined! Now draw 6 each.", "ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿ®ÿßÿØÿ¶! ÿßŸÑÿ¢ŸÜ ÿ≥ÿ≠ÿ® 6 ŸÑŸÉŸÑ ŸÑÿßÿπÿ®.");
        }

        // ========== DRAW FUNCTIONS (with bilingual messages) ==========
        function draw1Tile(player) {
            if (gameState.gamePhase !== 'draw1') return;
            playSound('draw');
            const bag = player === 'latin' ? gameState.latinBag : gameState.arabicBag;
            if (!bag.length) { showBilingualMessage("Bag empty!", "ÿßŸÑŸÉŸäÿ≥ ŸÅÿßÿ±ÿ∫!"); return; }
            const tile = bag.pop();
            if (player === 'latin') gameState.latinDrawnTile = tile; else gameState.arabicDrawnTile = tile;
            const letter = player === 'latin' ? tile.latinLetter : tile.arabicLetter || 'Blank';
            showBilingualMessage(`${player} drew: ${letter}`, `${player === 'latin' ? 'ÿßŸÑŸÑÿßÿ™ŸäŸÜŸä' : 'ÿßŸÑÿπÿ±ÿ®Ÿä'} ÿ≥ÿ≠ÿ®: ${letter}`, 3000);
            updateGameDisplay(); updateButtonStates();
            if (gameState.latinDrawnTile && gameState.arabicDrawnTile && !gameState.startingPlayerDetermined) setTimeout(determineStartingPlayer, 500);
        }

        function draw6Tiles(player) {
            if (gameState.gamePhase !== 'draw6') return;
            playSound('draw');
            const bag = player === 'latin' ? gameState.latinBag : gameState.arabicBag;
            const rack = player === 'latin' ? gameState.latinPlayRack : gameState.arabicPlayRack;
            if (!bag.length) { showBilingualMessage("Bag empty!", "ÿßŸÑŸÉŸäÿ≥ ŸÅÿßÿ±ÿ∫!"); return; }
            let drawn = 0;
            for (let i = 0; i < rack.length && drawn < 6 && bag.length > 0; i++) {
                if (rack[i] === null) { rack[i] = bag.pop(); drawn++; }
            }
            showBilingualMessage(`${player} drew ${drawn} tiles.`, `${player === 'latin' ? 'ÿßŸÑŸÑÿßÿ™ŸäŸÜŸä' : 'ÿßŸÑÿπÿ±ÿ®Ÿä'} ÿ≥ÿ≠ÿ® ${drawn} ŸÇÿ∑ÿπ.`, 3000);
            const latinHas6 = gameState.latinPlayRack.filter(t => t !== null).length >= 6;
            const arabicHas6 = gameState.arabicPlayRack.filter(t => t !== null).length >= 6;
            if (latinHas6 && arabicHas6) { gameState.gamePhase = 'play'; startTimer(); startGameTimer(); showBilingualMessage(`Play phase!`, 'ŸÖÿ±ÿ≠ŸÑÿ© ÿßŸÑŸÑÿπÿ®!', 5000); }
            updateGameDisplay(); updateButtonStates();
        }

        function draw3Tiles(player) {
            if (gameState.gamePhase !== 'play' || player !== gameState.currentPlayer) return;
            playSound('draw');
            const bag = player === 'latin' ? gameState.latinBag : gameState.arabicBag;
            const rack = player === 'latin' ? gameState.latinPlayRack : gameState.arabicPlayRack;
            if (!bag.length) { showBilingualMessage("Bag empty!", "ÿßŸÑŸÉŸäÿ≥ ŸÅÿßÿ±ÿ∫!"); return; }
            let drawn = 0;
            for (let i = 0; i < rack.length && drawn < 3 && bag.length > 0; i++) {
                if (rack[i] === null) { rack[i] = bag.pop(); drawn++; }
            }
            showBilingualMessage(`${player} drew ${drawn} tiles.`, `${player === 'latin' ? 'ÿßŸÑŸÑÿßÿ™ŸäŸÜŸä' : 'ÿßŸÑÿπÿ±ÿ®Ÿä'} ÿ≥ÿ≠ÿ® ${drawn} ŸÇÿ∑ÿπ.`, 3000);
            if (drawn > 0) setTimeout(() => endTurnAfterDraw(player), 1000);
            updateGameDisplay(); updateButtonStates();
        }

        function endTurnAfterDraw(p) {
            if (p !== gameState.currentPlayer) return;
            stopTimer(); gameState.currentPlayer = (gameState.currentPlayer === 'latin' ? 'arabic' : 'latin'); gameState.currentTurn++; startTimer();
            updateGameDisplay(); updateButtonStates(); showBilingualMessage(`${gameState.currentPlayer}'s turn`, `ÿØŸàÿ± ${gameState.currentPlayer === 'latin' ? 'ÿßŸÑŸÑÿßÿ™ŸäŸÜŸä' : 'ÿßŸÑÿπÿ±ÿ®Ÿä'}`, 3000);
        }

        function checkVictoryCondition() {
            for (let r = 0; r < 22; r++) {
                if (gameState.board[r][21] && gameState.board[r][21].player === 'latin' && !gameState.gameOver) {
                    gameState.gameOver = true; gameState.winner = 'latin'; stopTimer(); stopGameTimer(); showApplauseOverlay();
                }
                if (gameState.board[r][0] && gameState.board[r][0].player === 'arabic' && !gameState.gameOver) {
                    gameState.gameOver = true; gameState.winner = 'arabic'; stopTimer(); stopGameTimer(); showApplauseOverlay();
                }
            }
        }

        function updatePlayRackDisplay(containerId, rackData, rackType, player) {
            const container = document.getElementById(containerId); const rows = container.querySelectorAll('.play-rack-row');
            rows.forEach((row, ri) => { const slots = row.querySelectorAll('.slot'); slots.forEach((slot, ci) => { const idx = ri * 5 + ci; updateSlotDisplay(slot, rackData[idx], rackType, player, idx); }); });
        }

        function updateExperimentRackDisplay(containerId, rackData, rackType, player) {
            const container = document.getElementById(containerId); const slots = container.querySelectorAll('.slot');
            slots.forEach((slot, i) => updateSlotDisplay(slot, rackData[i], rackType, player, i));
        }

        function updateSlotDisplay(slot, tileData, rackType, player, idx) {
            slot.innerHTML = ''; slot.className = 'slot';
            if (tileData) { const tile = createTileElement(tileData, rackType, idx, player); slot.appendChild(tile); slot.classList.add('filled'); }
            else slot.classList.add('empty');
            slot.dataset.index = idx; slot.dataset.rack = rackType; slot.dataset.player = player;
        }

        function createTileElement(tileData, rackType, idx, player) {
            const tile = document.createElement('div'); tile.className = 'tile';
            if (player === 'latin') tile.classList.add('latin-tile'); else tile.classList.add('arabic-tile');
            if (tileData.isBlank) { tile.classList.add('blank-tile'); tile.classList.add(player === 'latin' ? 'latin-blank' : 'arabic-blank'); }
            else tile.classList.add(player === 'latin' ? 'latin-tile-bg' : 'arabic-tile-bg');
            if (rackType === 'board') tile.classList.add('board-tile');
            tile.dataset.id = tileData.id; tile.dataset.value = tileData.value; tile.dataset.rack = rackType; tile.dataset.index = idx; tile.dataset.player = player; tile.dataset.isArabic = tileData.isArabic;
            const main = document.createElement('div'); main.className = 'main-letter';
            if (tileData.isArabic) {
                main.textContent = tileData.arabicLetter || ''; main.style.fontFamily = "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif"; main.style.color = tileData.isBlank ? 'rgba(255,255,255,0.3)' : 'white';
                if (tileData.latinLetter) { const sec = document.createElement('div'); sec.className = 'secondary-letter'; sec.textContent = tileData.latinLetter; tile.appendChild(sec); }
            } else {
                main.textContent = tileData.latinLetter || ''; main.style.color = tileData.isBlank ? 'rgba(255,255,255,0.3)' : 'white';
                if (tileData.arabicLetter) { const sec = document.createElement('div'); sec.className = 'secondary-letter'; sec.textContent = tileData.arabicLetter; sec.style.fontFamily = "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif"; tile.appendChild(sec); }
            }
            tile.appendChild(main); applyTileSize(tile, rackType); return tile;
        }

        function applyTileSize(tile, containerType) {
            if (containerType === 'board') {
                tile.style.width = '100%'; tile.style.height = '100%'; tile.style.borderRadius = '4px';
                const ml = tile.querySelector('.main-letter'); if (ml) ml.style.fontSize = '1.2rem';
                const sec = tile.querySelector('.secondary-letter'); if (sec) { sec.style.width = '12px'; sec.style.height = '12px'; sec.style.fontSize = '0.5rem'; }
            } else {
                tile.style.width = '50px'; tile.style.height = '50px'; tile.style.borderRadius = '8px';
                const ml = tile.querySelector('.main-letter'); if (ml) ml.style.fontSize = '2.2rem';
                const sec = tile.querySelector('.secondary-letter'); if (sec) { sec.style.width = '22px'; sec.style.height = '22px'; sec.style.fontSize = '0.8rem'; }
            }
        }

        function updateBoardDisplay() {
            const cells = gameBoard.querySelectorAll('.board-cell');
            cells.forEach(cell => {
                const r = parseInt(cell.dataset.row), c = parseInt(cell.dataset.col);
                cell.innerHTML = ''; cell.className = 'board-cell'; applyColumnColor(cell, c);
                if ((r === 11 && c === 0) || (r === 10 && c === 21)) cell.classList.add('special-red');
                const tileData = gameState.board[r][c];
                if (tileData) {
                    const tile = createTileElement(tileData, 'board', 0, tileData.player);
                    tile.style.width = '100%'; tile.style.height = '100%'; cell.appendChild(tile);
                    cell.classList.add('filled'); cell.classList.add(`${tileData.player}-tile`);
                }
            });
        }

        // ========== CLICK-TO-STICK DRAG SYSTEM (exactly as original, but with bilingual feedback) ==========
        function handleTileClick(e) {
            e.preventDefault();
            
            if (gameState.isDragging) {
                handleTilePlacement(e);
                return;
            }
            
            if (gameState.gameOver || gameState.timeOver) return;
            
            const tile = e.target.closest('.tile');
            if (!tile) return;

            const player = tile.dataset.player;
            const rackType = tile.dataset.rack;
            const idx = parseInt(tile.dataset.index);
            
            if (rackType === 'board') {
                if (gameState.gamePhase !== 'play' || player !== gameState.currentPlayer) {
                    showBilingualMessage("Only current player can take board tiles during their turn.", "ŸÅŸÇÿ∑ ÿßŸÑŸÑÿßÿπÿ® ÿßŸÑÿ≠ÿßŸÑŸä ŸäŸÖŸÉŸÜŸá ÿ£ÿÆÿ∞ ŸÇÿ∑ÿπ ŸÖŸÜ ÿßŸÑŸÑŸàÿ≠ÿ© ŸÅŸä ÿØŸàÿ±Ÿá.");
                    return;
                }
                
                const cell = tile.parentElement;
                const r = parseInt(cell.dataset.row);
                const c = parseInt(cell.dataset.col);
                const tileData = gameState.board[r][c];
                if (!tileData) return;
                
                gameState.draggedTile = tileData;
                gameState.draggedFrom = {
                    player: player,
                    rack: rackType,
                    index: { row: r, col: c },
                    sourceArray: gameState.board
                };
                
                gameState.board[r][c] = null;
                if (player === 'latin') gameState.latinTilesPlaced--;
                else gameState.arabicTilesPlaced--;
                
            } else if (rackType === 'play' || rackType === 'experiment') {
                if (gameState.gamePhase === 'draw1' || gameState.gamePhase === 'draw6') {
                    showBilingualMessage("Cannot move tiles during draw phases.", "ŸÑÿß ŸäŸÖŸÉŸÜ ÿ™ÿ≠ÿ±ŸäŸÉ ÿßŸÑŸÇÿ∑ÿπ ÿÆŸÑÿßŸÑ ŸÖÿ±ÿ≠ŸÑÿ™Ÿä ÿßŸÑÿ≥ÿ≠ÿ®.");
                    return;
                }
                
                let rackArray;
                if (player === 'latin') {
                    rackArray = (rackType === 'play') ? gameState.latinPlayRack : gameState.latinExperimentRack;
                } else {
                    rackArray = (rackType === 'play') ? gameState.arabicPlayRack : gameState.arabicExperimentRack;
                }
                
                const tileData = rackArray[idx];
                if (!tileData) return;
                
                gameState.draggedTile = tileData;
                gameState.draggedFrom = {
                    player: player,
                    rack: rackType,
                    index: idx,
                    sourceArray: rackArray
                };
                
                rackArray[idx] = null;
            } else {
                return;
            }

            playSound('pickup');
            
            gameState.isDragging = true;
            
            draggingTileEl.innerHTML = '';
            draggingTileEl.className = gameState.draggedTile.isArabic ? 'arabic-tile' : 'latin-tile';
            
            if (gameState.draggedTile.isBlank) {
                draggingTileEl.classList.add('blank-tile');
                draggingTileEl.classList.add(gameState.draggedTile.isArabic ? 'arabic-blank' : 'latin-blank');
            } else {
                draggingTileEl.classList.add(gameState.draggedTile.isArabic ? 'arabic-tile-bg' : 'latin-tile-bg');
            }
            
            const main = document.createElement('div');
            main.className = 'main-letter';
            main.style.fontSize = '1.6rem';
            main.style.fontWeight = 'bold';
            main.style.color = gameState.draggedTile.isBlank ? 'rgba(255,255,255,0.3)' : 'white';
            
            if (gameState.draggedTile.isArabic) {
                main.textContent = gameState.draggedTile.arabicLetter || '';
            } else {
                main.textContent = gameState.draggedTile.latinLetter || '';
            }
            
            draggingTileEl.appendChild(main);
            
            draggingTileEl.style.left = e.clientX + 'px';
            draggingTileEl.style.top = e.clientY + 'px';
            draggingTileEl.style.display = 'block';
            
            updateGameDisplay();
            
            showBilingualMessage("Tile picked up! Click anywhere to place it.", "ÿ™ŸÖ ÿßŸÑÿ™ŸÇÿßÿ∑ ÿßŸÑŸÇÿ∑ÿπÿ©! ÿßŸÜŸÇÿ± ŸÅŸä ÿ£Ÿä ŸÖŸÉÿßŸÜ ŸÑŸàÿ∂ÿπŸáÿß.", 2000);
        }

        function handleMouseMove(e) {
            if (gameState.isDragging) {
                draggingTileEl.style.left = e.clientX + 'px';
                draggingTileEl.style.top = e.clientY + 'px';
            }
        }

        function handleTilePlacement(e) {
            if (!gameState.isDragging || !gameState.draggedTile) return;
            
            e.preventDefault();
            
            const elementsAtDrop = document.elementsFromPoint(e.clientX, e.clientY);
            
            let dropTarget = null;
            
            for (const el of elementsAtDrop) {
                if (el.classList.contains('slot') || el.classList.contains('board-cell')) {
                    dropTarget = el;
                    break;
                }
            }
            
            if (dropTarget) {
                if (dropTarget.classList.contains('slot')) {
                    const tile = gameState.draggedTile;
                    const targetPlayer = dropTarget.dataset.player;
                    const targetRack = dropTarget.dataset.rack;
                    const targetIdx = parseInt(dropTarget.dataset.index);
                    
                    if (targetPlayer !== tile.player) {
                        showBilingualMessage("Cannot place tile in opponent's rack.", "ŸÑÿß ŸäŸÖŸÉŸÜ Ÿàÿ∂ÿπ ÿßŸÑŸÇÿ∑ÿπÿ© ŸÅŸä ÿ≠ÿßŸÖŸÑ ÿßŸÑÿÆÿµŸÖ.");
                        returnToOriginalPosition();
                        return;
                    }
                    
                    if (gameState.gamePhase === 'draw1' || gameState.gamePhase === 'draw6') {
                        showBilingualMessage("Cannot move tiles during draw phases.", "ŸÑÿß ŸäŸÖŸÉŸÜ ÿ™ÿ≠ÿ±ŸäŸÉ ÿßŸÑŸÇÿ∑ÿπ ÿÆŸÑÿßŸÑ ŸÖÿ±ÿ≠ŸÑÿ™Ÿä ÿßŸÑÿ≥ÿ≠ÿ®.");
                        returnToOriginalPosition();
                        return;
                    }
                    
                    let targetArray;
                    if (targetPlayer === 'latin') {
                        targetArray = (targetRack === 'play') ? gameState.latinPlayRack : gameState.latinExperimentRack;
                    } else {
                        targetArray = (targetRack === 'play') ? gameState.arabicPlayRack : gameState.arabicExperimentRack;
                    }
                    
                    if (!targetArray || targetArray[targetIdx] !== null) {
                        showBilingualMessage("This slot is already occupied.", "Ÿáÿ∞Ÿá ÿßŸÑŸÅÿ™ÿ≠ÿ© ŸÖÿ¥ÿ∫ŸàŸÑÿ© ÿ®ÿßŸÑŸÅÿπŸÑ.");
                        returnToOriginalPosition();
                        return;
                    }
                    
                    targetArray[targetIdx] = tile;
                    playSound('rack');
                    finishDrag();
                    updateGameDisplay();
                    
                } else if (dropTarget.classList.contains('board-cell')) {
                    const tile = gameState.draggedTile;
                    
                    if (gameState.gamePhase !== 'play' || tile.player !== gameState.currentPlayer) {
                        showBilingualMessage("Only current player can place tiles on the board during their turn.", "ŸÅŸÇÿ∑ ÿßŸÑŸÑÿßÿπÿ® ÿßŸÑÿ≠ÿßŸÑŸä ŸäŸÖŸÉŸÜŸá Ÿàÿ∂ÿπ ÿßŸÑŸÇÿ∑ÿπ ÿπŸÑŸâ ÿßŸÑŸÑŸàÿ≠ÿ© ŸÅŸä ÿØŸàÿ±Ÿá.");
                        returnToOriginalPosition();
                        return;
                    }
                    
                    const r = parseInt(dropTarget.dataset.row);
                    const c = parseInt(dropTarget.dataset.col);
                    
                    if (gameState.board[r][c] !== null) {
                        showBilingualMessage("This board cell is already occupied.", "Ÿáÿ∞Ÿá ÿßŸÑÿÆŸÑŸäÿ© ŸÖÿ¥ÿ∫ŸàŸÑÿ© ÿ®ÿßŸÑŸÅÿπŸÑ.");
                        returnToOriginalPosition();
                        return;
                    }
                    
                    gameState.board[r][c] = tile;
                    if (tile.player === 'latin') gameState.latinTilesPlaced++;
                    else gameState.arabicTilesPlaced++;
                    
                    playSound('board');
                    calculatePlayerProgress();
                    setTimeout(() => checkVictoryCondition(), 50);
                    finishDrag();
                    updateGameDisplay();
                }
            } else {
                returnToOriginalPosition();
            }
        }

        function returnToOriginalPosition() {
            if (!gameState.isDragging || !gameState.draggedTile || !gameState.draggedFrom) return;
            
            const { player, rack, index, sourceArray } = gameState.draggedFrom;
            
            if (rack === 'board') {
                gameState.board[index.row][index.col] = gameState.draggedTile;
                if (player === 'latin') gameState.latinTilesPlaced++;
                else gameState.arabicTilesPlaced++;
            } else {
                sourceArray[index] = gameState.draggedTile;
            }
            
            finishDrag();
            updateGameDisplay();
            showBilingualMessage("Tile returned to original position.", "ÿ™ŸÖ ÿ•ÿ±ÿ¨ÿßÿπ ÿßŸÑŸÇÿ∑ÿπÿ© ÿ•ŸÑŸâ ŸÖŸàÿ∂ÿπŸáÿß ÿßŸÑÿ£ÿµŸÑŸä.", 1500);
        }

        function finishDrag() {
            draggingTileEl.style.display = 'none';
            draggingTileEl.innerHTML = '';
            gameState.draggedTile = null;
            gameState.draggedFrom = null;
            gameState.isDragging = false;
        }

        function setupEventListeners() {
            document.removeEventListener('click', handleTileClick);
            document.removeEventListener('mousemove', handleMouseMove);
            
            document.addEventListener('click', handleTileClick);
            document.addEventListener('mousemove', handleMouseMove);
            
            document.querySelectorAll('.tile').forEach(t => {
                t.addEventListener('dragstart', (e) => e.preventDefault());
            });
            
            latinDraw1Btn.onclick = () => draw1Tile('latin');
            latinDraw6Btn.onclick = () => draw6Tiles('latin');
            latinDraw3Btn.onclick = () => draw3Tiles('latin');
            arabicDraw1Btn.onclick = () => draw1Tile('arabic');
            arabicDraw6Btn.onclick = () => draw6Tiles('arabic');
            arabicDraw3Btn.onclick = () => draw3Tiles('arabic');
            document.getElementById('newGameBtnTop').onclick = initGame;
            
            decreaseDurationBtn.onclick = () => {
                if (gameState.gamePhase !== 'play') {
                    gameState.gameDuration = Math.max(10 * 60, gameState.gameDuration - 10 * 60);
                    gameState.gameTimeRemaining = gameState.gameDuration;
                    updateDurationDisplay();
                }
            };
            increaseDurationBtn.onclick = () => {
                if (gameState.gamePhase !== 'play') {
                    gameState.gameDuration = Math.min(120 * 60, gameState.gameDuration + 10 * 60);
                    gameState.gameTimeRemaining = gameState.gameDuration;
                    updateDurationDisplay();
                }
            };
        }

        function shuffleArray(a) {
            for (let i = a.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
            return a;
        }

        // Start the game
        initGame();
        console.log('Words War with bilingual instructions & click-to-stick ¬∑ columns reached fixed (max 22)');
    </script>
</body>
</html>
